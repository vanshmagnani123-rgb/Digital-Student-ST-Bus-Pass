<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Bus Pass</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    /* ---------- Section Layout ---------- */
.section {
  width: 100%;
  max-width: 520px;
  background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.97));
  border-radius: 12px;
  padding: 26px;
  box-shadow: 0 8px 30px rgba(23, 35, 62, 0.08);
  border: 1px solid rgba(15,23,42,0.05);
  backdrop-filter: blur(6px);
  margin: 24px auto;
}

/* ---------- Title ---------- */
.section-title {
  margin: 0 0 14px 0;
  font-size: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  color: #0b1220;
}

/* ---------- Form ---------- */
#passForm {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

/* Input */
#passForm input[type="text"] {
  flex: 1;
  min-width: 200px;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid rgba(15,23,42,0.08);
  background: linear-gradient(180deg, #fff, #fbfdff);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
  font-size: 14px;
  outline: none;
  transition: border-color 200ms ease, box-shadow 200ms ease, transform 200ms ease;
  color: #0b1220;
  box-sizing: border-box;
}

#passForm input::placeholder {
  color: #94a3b8;
  font-size: 13px;
}

#passForm input:focus {
  border-color: #2b6ef6;
  box-shadow: 0 6px 20px rgba(43,110,246,0.12);
  transform: translateY(-1px);
}

/* Button */
.btn {
  background: linear-gradient(90deg, #2b6ef6, #7c5cff);
  color: #fff;
  border: none;
  padding: 12px 20px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  font-size: 15px;
  box-shadow: 0 8px 22px rgba(44,110,246,0.16);
  transition: transform 200ms ease, box-shadow 200ms ease, opacity 200ms ease;
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 36px rgba(44,110,246,0.18);
}

.btn:active {
  transform: translateY(-1px) scale(0.998);
}

/* ---------- Responsive ---------- */
@media (max-width: 560px) {
  #passForm {
    flex-direction: column;
    gap: 10px;
  }
  .btn {
    width: 100%;
    text-align: center;
  }
}

  </style>
  
  

  <!-- ‚úÖ Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="container nav-inner">
      <a class="brand" href="index.html">TeamQride</a>

      <button class="nav-toggle" aria-label="Menu">
        <span class="hamburger"></span>
      </button>

      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="apply.html">Apply</a></li>
        <li><a href="status.html">Check Status</a></li>
        <li><a href="pass.html">Download Pass</a></li>
      </ul>
    </div>
  </nav>

  <!-- Form Section -->
  <section class="section">
    <h2 class="section-title">üé´ Download Your Bus Pass</h2>
    <form id="passForm">
      <input type="text" id="appNo" placeholder="Enter Application Number" required>
      <button type="submit" class="btn">Get Pass</button>
    </form>
    <div id="passContainer" style="margin-top:20px;"></div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("passForm");
      const passContainer = document.getElementById("passContainer");

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const appNo = document.getElementById("appNo").value.trim();
        const data = localStorage.getItem(appNo);

        passContainer.innerHTML = "";

        if (!data) {
          passContainer.innerHTML = `<p style="color:red;">‚ùå Application Number not found!</p>`;
          return;
        }

        const appData = JSON.parse(data);

        // Store appNo inside data if missing
        if (!appData.appNo) {
          appData.appNo = appNo;
        }

        if (appData.status !== "Approved") {
          passContainer.innerHTML = `<p style="color:orange;">‚ö†Ô∏è Your application is <strong>${appData.status}</strong>. Pass will be available only after Approval.</p>`;
          return;
        }

        // Bus Pass Card
passContainer.innerHTML = `
  <div class="card" id="bus-pass">
    <div class="bus-pass-header">
      <h3>City Transport Service</h3>
      <p style="color:white;">Digital Student Bus Pass</p>
    </div>
    <div class="bus-pass-body">
      <img src="${appData.photo}" alt="Student Photo" class="student-photo" width="120px">  <!-- ‚úÖ Show uploaded photo -->
      <div class="bus-pass-details">
        <p><strong>Name:</strong> ${appData.name}</p>
        <p><strong>Roll No:</strong> ${appData.roll}</p>
        <p><strong>College:</strong> ${appData.college}</p>
        <p><strong>Route:</strong> ${appData.route}</p>
        <p><strong>Valid Till:</strong> 31 Dec 2025</p>
      </div>
    </div>
    <div class="bus-pass-footer">
      <div id="qrcode"></div>
      <small>Issued by City Transport Dept.</small>
    </div>
  </div>
  <button class="btn" onclick="downloadPass()">‚¨á Download PDF</button>
`;


        // ‚úÖ QR Code Generation
        setTimeout(() => {
          if (appData.appNo) {
            new QRCode(document.getElementById("qrcode"), {
              text: appData.appNo,   // Only AppNo for scanner
              width: 100,
              height: 100,
              colorDark: "#000000",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
            console.log("QR Generated for:", appData.appNo);
          } else {
            console.error("‚ö†Ô∏è Application Number missing, QR not generated!");
          }
        }, 200);
      });
    });

    // ‚úÖ PDF Download
    window.downloadPass = function () {
      const pass = document.getElementById("bus-pass");

      html2canvas(pass).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        pdf.addImage(imgData, "PNG", 10, 10, pdfWidth - 20, pdfHeight);
        pdf.save("Digital-Bus-Pass.pdf");
      });
    };
  </script>
</body>
</html>
